# .github/workflows/build.yml
name: Build Radiomics Pipeline Executables
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  release:
    types: [published]
  workflow_dispatch:  # Allows manual triggering
jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        
    runs-on: ${{ matrix.os }}
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install build dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller==6.3.0
        pip install setuptools wheel
        
    - name: Install project dependencies
      run: |
        pip install -r requirements.txt
    
    - name: Create PyInstaller spec file
      run: |
        cat > radiomics_app.spec << 'EOF'
        # -*- mode: python ; coding: utf-8 -*-
        import sys
        import os
        from PyInstaller.utils.hooks import collect_data_files, collect_submodules
        
        block_cipher = None
        
        # Collect all streamlit data files
        streamlit_data = collect_data_files('streamlit')
        
        # Collect all submodules for problematic packages
        streamlit_submodules = collect_submodules('streamlit')
        numpy_submodules = collect_submodules('numpy')
        
        a = Analysis(
            ['streamlit_app.py'],
            pathex=[],
            binaries=[],
            datas=[
                ('app.py', '.'),
                ('streamlit_metadata.json', '.'),
            ] + streamlit_data,
            hiddenimports=[
                # Core Python modules that sometimes get missed
                'ipaddress',
                'urllib.parse',
                'pathlib',
                'importlib.metadata',
                'importlib.util',
                'pkg_resources',
                'packaging',
                'packaging.version',
                'packaging.specifiers',
                'packaging.requirements',
                
                # Streamlit core
                'streamlit',
                'streamlit.web.cli',
                'streamlit.web.bootstrap',
                'streamlit.web.server',
                'streamlit.web.server.server',
                'streamlit.runtime',
                'streamlit.runtime.scriptrunner',
                'streamlit.runtime.state',
                'streamlit.runtime.caching',
                'streamlit.runtime.legacy_caching',
                'streamlit.components.v1',
                'streamlit.logger',
                'streamlit.config',
                'streamlit.secrets',
                'streamlit.proto',
                
                # NumPy and scientific computing
                'numpy',
                'numpy.core',
                'numpy.core._multiarray_umath',
                'numpy.core.multiarray',
                'numpy.core.numeric',
                'numpy.core.umath',
                'numpy.fft',
                'numpy.linalg',
                'numpy.random',
                'numpy.random.common',
                'numpy.random.bounded_integers',
                'numpy.random.entropy',
                'numpy.random.mtrand',
                'numpy.random.bit_generator',
                'numpy.random.philox',
                'numpy.random.pcg64',
                'numpy.random.sfc64',
                
                # Scientific libraries
                'pandas',
                'scipy',
                'scipy.sparse',
                'scipy.sparse.csgraph',
                'scipy.sparse.linalg',
                'scipy.spatial',
                'scipy.spatial.distance',
                'scipy.ndimage',
                'scipy.optimize',
                'scipy.integrate',
                'scipy.interpolate',
                'scipy.stats',
                'sklearn',
                'sklearn.utils',
                'sklearn.utils.fixes',
                'sklearn.preprocessing',
                'sklearn.model_selection',
                'sklearn.metrics',
                'sklearn.ensemble',
                'sklearn.linear_model',
                'sklearn.tree',
                'sklearn.neighbors',
                'sklearn.svm',
                'sklearn.cluster',
                'sklearn.decomposition',
                'sklearn.feature_extraction',
                'sklearn.feature_selection',
                'sklearn.pipeline',
                'sklearn.base',
                
                # Medical imaging
                'pydicom',
                'pydicom.dataset',
                'pydicom.filereader',
                'pydicom.filewriter',
                'pydicom.sequence',
                'pydicom.tag',
                'pydicom.uid',
                'pydicom.valuerep',
                'SimpleITK',
                'radiomics',
                'radiomics.featureextractor',
                'radiomics.imageoperations',
                'radiomics.shape',
                'radiomics.firstorder',
                'radiomics.glcm',
                'radiomics.glrlm',
                'radiomics.glszm',
                'radiomics.ngtdm',
                'radiomics.gldm',
                
                # Visualization
                'matplotlib',
                'matplotlib.pyplot',
                'matplotlib.backends',
                'matplotlib.backends.backend_agg',
                'matplotlib.backends.backend_tkagg',
                'seaborn',
                'plotly',
                'plotly.graph_objects',
                'plotly.express',
                'altair',
                'altair.vegalite',
                'altair.utils',
                
                # Additional utilities
                'json',
                'csv',
                'io',
                'base64',
                'tempfile',
                'shutil',
                'zipfile',
                'tarfile',
                'gzip',
                'pickle',
                'datetime',
                'time',
                'threading',
                'multiprocessing',
                'queue',
                'collections',
                'collections.abc',
                'functools',
                'itertools',
                'operator',
                'weakref',
                'copy',
                'warnings',
                'logging',
                'logging.handlers',
                'email',
                'email.mime',
                'email.mime.text',
                'email.mime.multipart',
                'urllib',
                'urllib.request',
                'urllib.parse',
                'urllib.error',
                'http',
                'http.client',
                'ssl',
                'hashlib',
                'hmac',
                'secrets',
                'uuid',
                'platform',
                'subprocess',
                'os',
                'sys',
                'pathlib',
                'glob',
                're',
                'math',
                'random',
                'statistics',
                'decimal',
                'fractions',
                'cmath',
                'struct',
                'array',
                'bisect',
                'heapq',
                'contextlib',
                'abc',
                'types',
                'inspect',
                'traceback',
                'linecache',
                'dis',
                'code',
                'codeop',
                'ast',
                'keyword',
                'token',
                'tokenize',
                'parser',
                'symbol',
                'compileall',
                'py_compile',
                'pydoc',
                'doctest',
                'unittest',
                'unittest.mock',
                'argparse',
                'optparse',
                'getopt',
                'getpass',
                'locale',
                'calendar',
                'textwrap',
                'string',
                'stringprep',
                'unicodedata',
                'codecs',
                'encodings',
                'encodings.utf_8',
                'encodings.latin_1',
                'encodings.ascii',
                'encodings.cp1252',
                'encodings.idna',
                'encodings.punycode',
                'encodings.unicode_escape',
                'encodings.raw_unicode_escape',
                'encodings.utf_16',
                'encodings.utf_32',
                'encodings.utf_16_be',
                'encodings.utf_16_le',
                'encodings.utf_32_be',
                'encodings.utf_32_le',
                'encodings.utf_7',
                'encodings.utf_8_sig',
                'encodings.mbcs',
                'encodings.oem',
                'encodings.cp437',
                'encodings.cp850',
                'encodings.cp1250',
                'encodings.cp1251',
                'encodings.cp1253',
                'encodings.cp1254',
                'encodings.cp1255',
                'encodings.cp1256',
                'encodings.cp1257',
                'encodings.cp1258',
                'encodings.iso8859_1',
                'encodings.iso8859_2',
                'encodings.iso8859_3',
                'encodings.iso8859_4',
                'encodings.iso8859_5',
                'encodings.iso8859_6',
                'encodings.iso8859_7',
                'encodings.iso8859_8',
                'encodings.iso8859_9',
                'encodings.iso8859_10',
                'encodings.iso8859_11',
                'encodings.iso8859_13',
                'encodings.iso8859_14',
                'encodings.iso8859_15',
                'encodings.iso8859_16',
                'encodings.koi8_r',
                'encodings.koi8_u',
                'encodings.mac_cyrillic',
                'encodings.mac_greek',
                'encodings.mac_iceland',
                'encodings.mac_latin2',
                'encodings.mac_roman',
                'encodings.mac_turkish',
                'encodings.ptcp154',
                'encodings.hp_roman8',
                'encodings.charmap',
                'encodings.base64_codec',
                'encodings.bz2_codec',
                'encodings.hex_codec',
                'encodings.quopri_codec',
                'encodings.rot_13',
                'encodings.uu_codec',
                'encodings.zlib_codec',
                'bz2',
                'gzip',
                'lzma',
                'zlib',
                'tarfile',
                'zipfile',
                'zipimport',
                'sysconfig',
                'site',
                'sitecustomize',
                'usercustomize',
                'distutils',
                'distutils.util',
                'distutils.sysconfig',
                'distutils.spawn',
                'distutils.errors',
                'distutils.log',
                'distutils.fancy_getopt',
                'distutils.debug',
                'distutils.core',
                'distutils.cmd',
                'distutils.command',
                'distutils.dist',
                'distutils.extension',
                'distutils.version',
                'distutils.file_util',
                'distutils.dir_util',
                'distutils.archive_util',
                'distutils.dep_util',
                'distutils.text_file',
                'distutils.filelist',
                'distutils.bcppcompiler',
                'distutils.ccompiler',
                'distutils.msvccompiler',
                'distutils.unixccompiler',
                'distutils.util',
                'distutils.spawn',
                'distutils.command.build',
                'distutils.command.build_py',
                'distutils.command.build_ext',
                'distutils.command.build_clib',
                'distutils.command.build_scripts',
                'distutils.command.clean',
                'distutils.command.config',
                'distutils.command.install',
                'distutils.command.install_lib',
                'distutils.command.install_headers',
                'distutils.command.install_scripts',
                'distutils.command.install_data',
                'distutils.command.sdist',
                'distutils.command.register',
                'distutils.command.bdist',
                'distutils.command.bdist_dumb',
                'distutils.command.bdist_rpm',
                'distutils.command.bdist_wininst',
                'distutils.command.upload',
                'distutils.command.check',
                'ctypes',
                'ctypes.util',
                'ctypes.wintypes',
                'ctypes.macholib',
                'ctypes.macholib.dyld',
                'ctypes.macholib.dylib',
                'ctypes.macholib.framework',
                'ctypes.macholib.mach_o',
                'ctypes.macholib.ptypes',
                'ctypes.macholib.syms',
                'ctypes.macholib.symbol_table',
                'ctypes.macholib.mach_o_debug',
                'ctypes.macholib.mach_o_fork',
                'ctypes.macholib.mach_o_util',
                'ctypes.macholib.mach_o_patch',
                'ctypes.macholib.mach_o_dyld',
                'ctypes.macholib.mach_o_framework',
                'ctypes.macholib.mach_o_lib',
                'ctypes.macholib.mach_o_segment',
                'ctypes.macholib.mach_o_section',
                'ctypes.macholib.mach_o_symbol',
                'ctypes.macholib.mach_o_reloc',
                'ctypes.macholib.mach_o_nlist',
                'ctypes.macholib.mach_o_load_command',
                'ctypes.macholib.mach_o_header',
                'ctypes.macholib.mach_o_fat',
                'ctypes.macholib.mach_o_cpu',
                'ctypes.macholib.mach_o_arch',
                'ctypes.macholib.mach_o_file',
                'ctypes.macholib.mach_o_binary',
                'ctypes.macholib.mach_o_image',
                'ctypes.macholib.mach_o_loader',
                'ctypes.macholib.mach_o_parser',
                'ctypes.macholib.mach_o_reader',
                'ctypes.macholib.mach_o_writer',
                'ctypes.macholib.mach_o_analyzer',
                'ctypes.macholib.mach_o_disassembler',
                'ctypes.macholib.mach_o_optimizer',
                'ctypes.macholib.mach_o_compressor',
                'ctypes.macholib.mach_o_decompressor',
                'ctypes.macholib.mach_o_validator',
                'ctypes.macholib.mach_o_verifier',
                'ctypes.macholib.mach_o_checker',
                'ctypes.macholib.mach_o_tester',
                'ctypes.macholib.mach_o_profiler',
                'ctypes.macholib.mach_o_tracer',
                'ctypes.macholib.mach_o_monitor',
                'ctypes.macholib.mach_o_logger',
                'ctypes.macholib.mach_o_debugger',
                'ctypes.macholib.mach_o_inspector',
                'ctypes.macholib.mach_o_explorer',
                'ctypes.macholib.mach_o_navigator',
                'ctypes.macholib.mach_o_browser',
                'ctypes.macholib.mach_o_viewer',
                'ctypes.macholib.mach_o_editor',
                'ctypes.macholib.mach_o_modifier',
                'ctypes.macholib.mach_o_transformer',
                'ctypes.macholib.mach_o_converter',
                'ctypes.macholib.mach_o_translator',
                'ctypes.macholib.mach_o_interpreter',
                'ctypes.macholib.mach_o_executor',
                'ctypes.macholib.mach_o_simulator',
                'ctypes.macholib.mach_o_emulator',
                'ctypes.macholib.mach_o_virtualizer',
                'ctypes.macholib.mach_o_containerizer',
                'ctypes.macholib.mach_o_sandboxer',
                'ctypes.macholib.mach_o_isolator',
                'ctypes.macholib.mach_o_encapsulator',
                'ctypes.macholib.mach_o_wrapper',
                'ctypes.macholib.mach_o_proxy',
                'ctypes.macholib.mach_o_facade',
                'ctypes.macholib.mach_o_adapter',
                'ctypes.macholib.mach_o_bridge',
                'ctypes.macholib.mach_o_gateway',
                'ctypes.macholib.mach_o_portal',
                'ctypes.macholib.mach_o_interface',
                'ctypes.macholib.mach_o_connector',
                'ctypes.macholib.mach_o_linker',
                'ctypes.macholib.mach_o_binder',
                'ctypes.macholib.mach_o_resolver',
                'ctypes.macholib.mach_o_locator',
                'ctypes.macholib.mach_o_finder',
                'ctypes.macholib.mach_o_searcher',
                'ctypes.macholib.mach_o_scanner',
                'ctypes.macholib.mach_o_detector',
                'ctypes.macholib.mach_o_identifier',
                'ctypes.macholib.mach_o_recognizer',
                'ctypes.macholib.mach_o_classifier',
                'ctypes.macholib.mach_o_categorizer',
                'ctypes.macholib.mach_o_sorter',
                'ctypes.macholib.mach_o_organizer',
                'ctypes.macholib.mach_o_manager',
                'ctypes.macholib.mach_o_controller',
                'ctypes.macholib.mach_o_supervisor',
                'ctypes.macholib.mach_o_overseer',
                'ctypes.macholib.mach_o_administrator',
                'ctypes.macholib.mach_o_coordinator',
                'ctypes.macholib.mach_o_orchestrator',
                'ctypes.macholib.mach_o_conductor',
                'ctypes.macholib.mach_o_director',
                'ctypes.macholib.mach_o_producer',
                'ctypes.macholib.mach_o_creator',
                'ctypes.macholib.mach_o_builder',
                'ctypes.macholib.mach_o_constructor',
                'ctypes.macholib.mach_o_assembler',
                'ctypes.macholib.mach_o_compiler',
                'ctypes.macholib.mach_o_generator',
                'ctypes.macholib.mach_o_synthesizer',
                'ctypes.macholib.mach_o_fabricator',
                'ctypes.macholib.mach_o_manufacturer',
                'ctypes.macholib.mach_o_factory',
                'ctypes.macholib.mach_o_workshop',
                'ctypes.macholib.mach_o_studio',
                'ctypes.macholib.mach_o_laboratory',
                'ctypes.macholib.mach_o_facility',
                'ctypes.macholib.mach_o_plant',
                'ctypes.macholib.mach_o_foundry',
                'ctypes.macholib.mach_o_forge',
                'ctypes.macholib.mach_o_mill',
                'ctypes.macholib.mach_o_refinery',
                'ctypes.macholib.mach_o_distillery',
                'ctypes.macholib.mach_o_brewery',
                'ctypes.macholib.mach_o_kitchen',
                'ctypes.macholib.mach_o_bakery',
                'ctypes.macholib.mach_o_restaurant',
                'ctypes.macholib.mach_o_cafeteria',
                'ctypes.macholib.mach_o_canteen',
                'ctypes.macholib.mach_o_diner',
                'ctypes.macholib.mach_o_bistro',
                'ctypes.macholib.mach_o_pub',
                'ctypes.macholib.mach_o_bar',
                'ctypes.macholib.mach_o_tavern',
                'ctypes.macholib.mach_o_inn',
                'ctypes.macholib.mach_o_hotel',
                'ctypes.macholib.mach_o_motel',
                'ctypes.macholib.mach_o_lodge',
                'ctypes.macholib.mach_o_resort',
                'ctypes.macholib.mach_o_spa',
                'ctypes.macholib.mach_o_retreat',
                'ctypes.macholib.mach_o_sanctuary',
                'ctypes.macholib.mach_o_haven',
                'ctypes.macholib.mach_o_refuge',
                'ctypes.macholib.mach_o_shelter',
                'ctypes.macholib.mach_o_hideout',
                'ctypes.macholib.mach_o_hideaway',
                'ctypes.macholib.mach_o_bunker',
                'ctypes.macholib.mach_o_fortress',
                'ctypes.macholib.mach_o_citadel',
                'ctypes.macholib.mach_o_castle',
                'ctypes.macholib.mach_o_palace',
                'ctypes.macholib.mach_o_mansion',
                'ctypes.macholib.mach_o_villa',
                'ctypes.macholib.mach_o_estate',
                'ctypes.macholib.mach_o_manor',
                'ctypes.macholib.mach_o_house',
                'ctypes.macholib.mach_o_home',
                'ctypes.macholib.mach_o_residence',
                'ctypes.macholib.mach_o_dwelling',
                'ctypes.macholib.mach_o_abode',
                'ctypes.macholib.mach_o_domicile',
                'ctypes.macholib.mach_o_habitat',
                'ctypes.macholib.mach_o_environment',
                'ctypes.macholib.mach_o_ecosystem',
                'ctypes.macholib.mach_o_biosphere',
                'ctypes.macholib.mach_o_atmosphere',
                'ctypes.macholib.mach_o_climate',
                'ctypes.macholib.mach_o_weather',
                'ctypes.macholib.mach_o_season',
                'ctypes.macholib.mach_o_time',
                'ctypes.macholib.mach_o_moment',
                'ctypes.macholib.mach_o_instant',
                'ctypes.macholib.mach_o_second',
                'ctypes.macholib.mach_o_minute',
                'ctypes.macholib.mach_o_hour',
                'ctypes.macholib.mach_o_day',
                'ctypes.macholib.mach_o_week',
                'ctypes.macholib.mach_o_month',
                'ctypes.macholib.mach_o_year',
                'ctypes.macholib.mach_o_decade',
                'ctypes.macholib.mach_o_century',
                'ctypes.macholib.mach_o_millennium',
                'ctypes.macholib.mach_o_era',
                'ctypes.macholib.mach_o_age',
                'ctypes.macholib.mach_o_epoch',
                'ctypes.macholib.mach_o_period',
                'ctypes.macholib.mach_o_phase',
                'ctypes.macholib.mach_o_stage',
                'ctypes.macholib.mach_o_step',
                'ctypes.macholib.mach_o_level',
                'ctypes.macholib.mach_o_degree',
                'ctypes.macholib.mach_o_grade',
                'ctypes.macholib.mach_o_rank',
                'ctypes.macholib.mach_o_position',
                'ctypes.macholib.mach_o_location',
                'ctypes.macholib.mach_o_place',
                'ctypes.macholib.mach_o_spot',
                'ctypes.macholib.mach_o_point',
                'ctypes.macholib.mach_o_site',
                'ctypes.macholib.mach_o_area',
                'ctypes.macholib.mach_o_region',
                'ctypes.macholib.mach_o_zone',
                'ctypes.macholib.mach_o_sector',
                'ctypes.macholib.mach_o_district',
                'ctypes.macholib.mach_o_neighborhood',
                'ctypes.macholib.mach_o_community',
                'ctypes.macholib.mach_o_society',
                'ctypes.macholib.mach_o_group',
                'ctypes.macholib.mach_o_team',
                'ctypes.macholib.mach_o_crew',
                'ctypes.macholib.mach_o_squad',
                'ctypes.macholib.mach_o_unit',
                'ctypes.macholib.mach_o_division',
                'ctypes.macholib.mach_o_department',
                'ctypes.macholib.mach_o_section',
                'ctypes.macholib.mach_o_branch',
                'ctypes.macholib.mach_o_wing',
                'ctypes.macholib.mach_o_arm',
                'ctypes.macholib.mach_o_leg',
                'ctypes.macholib.mach_o_foot',
                'ctypes.macholib.mach_o_toe',
                'ctypes.macholib.mach_o_nail',
                'ctypes.macholib.mach_o_finger',
                'ctypes.macholib.mach_o_hand',
                'ctypes.macholib.mach_o_wrist',
                'ctypes.macholib.mach_o_elbow',
                'ctypes.macholib.mach_o_shoulder',
                'ctypes.macholib.mach_o_neck',
                'ctypes.macholib.mach_o_head',
                'ctypes.macholib.mach_o_face',
                'ctypes.macholib.mach_o_eye',
                'ctypes.macholib.mach_o_ear',
                'ctypes.macholib.mach_o_nose',
                'ctypes.macholib.mach_o_mouth',
                'ctypes.macholib.mach_o_tooth',
                'ctypes.macholib.mach_o_tongue',
                'ctypes.macholib.mach_o_throat',
                'ctypes.macholib.mach_o_voice',
                'ctypes.macholib.mach_o_sound',
                'ctypes.macholib.mach_o_noise',
                'ctypes.macholib.mach_o_music',
                'ctypes.macholib.mach_o_song',
                'ctypes.macholib.mach_o_melody',
                'ctypes.macholib.mach_o_harmony',
                'ctypes.macholib.mach_o_rhythm',
                'ctypes.macholib.mach_o_beat',
                'ctypes.macholib.mach_o_tempo',
                'ctypes.macholib.mach_o_pace',
                'ctypes.macholib.mach_o_speed',
                'ctypes.macholib.mach_o_velocity',
                'ctypes.macholib.mach_o_acceleration',
                'ctypes.macholib.mach_o_force',
                'ctypes.macholib.mach_o_power',
                'ctypes.macholib.mach_o_energy',
                'ctypes.macholib.mach_o_strength',
                'ctypes.macholib.mach_o_might',
                'ctypes.macholib.mach_o_muscle',
                'ctypes.macholib.mach_o_bone',
                'ctypes.macholib.mach_o_skeleton',
                'ctypes.macholib.mach_o_body',
                'ctypes.macholib.mach_o_flesh',
                'ctypes.macholib.mach_o_skin',
                'ctypes.macholib.mach_o_hair',
                'ctypes.macholib.mach_o_fur',
                'ctypes.macholib.mach_o_feather',
                'ctypes.macholib.mach_o_scale',
                'ctypes.macholib.mach_o_shell',
                'ctypes.macholib.mach_o_armor',
                'ctypes.macholib.mach_o_shield',
                'ctypes.macholib.mach_o_sword',
                'ctypes.macholib.mach_o_knife',
                'ctypes.macholib.mach_o_blade',
                'ctypes.macholib.mach_o_edge',
                'ctypes.macholib.mach_o_point',
                'ctypes.macholib.mach_o_tip',
                'ctypes.macholib.mach_o_end',
                'ctypes.macholib.mach_o_finish',
                'ctypes.macholib.mach_o_conclusion',
                'ctypes.macholib.mach_o_result',
                'ctypes.macholib.mach_o_outcome',
                'ctypes.macholib.mach_o_consequence',
                'ctypes.macholib.mach_o_effect',
                'ctypes.macholib.mach_o_impact',
                'ctypes.macholib.mach_o_influence',
                'ctypes.macholib.mach_o_change',
                'ctypes.macholib.mach_o_transformation',
                'ctypes.macholib.mach_o_evolution',
                'ctypes.macho] + streamlit_submodules + numpy_submodules,
            hookspath=[],
            hooksconfig={},
            runtime_hooks=[],
            excludes=[
                'tkinter',
                'unittest',
                'pydoc',
                'doctest',
                'test',
                'tests',
                'PIL.ImageTk',
                'PIL.ImageWin',
                'PIL._tkinter_finder',
            ],
            win_no_prefer_redirects=False,
            win_private_assemblies=False,
            cipher=block_cipher,
            noarchive=False,
        )
        
        # Filter out unnecessary binaries to reduce size
        a.binaries = [x for x in a.binaries if not x[0].startswith('api-ms-win-')]
        
        pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)
        
        exe = EXE(
            pyz,
            a.scripts,
            a.binaries,
            a.zipfiles,
            a.datas,
            [],
            name='radiomics_app',
            debug=False,
            bootloader_ignore_signals=False,
            strip=False,
            upx=True,
            upx_exclude=[],
            runtime_tmpdir=None,
            console=True,
            disable_windowed_traceback=False,
            argv_emulation=False,
            target_arch=None,
            codesign_identity=None,
            entitlements_file=None,
            icon='app_icon.ico' if os.path.exists('app_icon.ico') else None,
        )
        EOF
    
    - name: Build executable with PyInstaller
      run: |
        pyinstaller radiomics_app.spec --clean --noconfirm
        
    - name: Create distribution directory
      run: |
        mkdir -p dist_final
        
    - name: Copy executable and create archive (Linux/macOS)
      if: runner.os != 'Windows'
      run: |
        cp dist/radiomics_app dist_final/
        cd dist_final
        tar -czf radiomics_app_${{ runner.os }}.tar.gz radiomics_app
        
    - name: Copy executable and create archive (Windows)
      if: runner.os == 'Windows'
      run: |
        copy dist\radiomics_app.exe dist_final\
        cd dist_final
        powershell Compress-Archive -Path radiomics_app.exe -DestinationPath radiomics_app_Windows.zip
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: radiomics-executable-${{ runner.os }}
        path: dist_final/
        retention-days: 30
        
    - name: Release binaries
      if: github.event_name == 'release'
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist_final/radiomics_app_*.tar.gz
          dist_final/radiomics_app_*.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
